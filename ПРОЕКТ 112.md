[[112.canvas|112]]
[[ЕСИА]]
[[Оповещения]]
[[Фильтрация]]

### БИЗНЕС ЛОГИКА

## Как работает отправка оповещений ДЛ
Сначала запускается таска от селери `@celery_app.task(name='officialsnotification.tasks.worker')`

Дальше вызывается ф-я `search_scheduled_notifications()`. В ней выбираются оповещения(`Notification`)чей 
status=AbstractBroadcastStatus.SCHEDULED (Запланирован)

Дальше вызывается `start_broadcast` в ней происходит смена статуса на 
`notification.status = AbstractBroadcastStatus.QUEUED (Отправка)`

Дальше Происходит вызов 3 функций по порядку:
1. `create_broadcast_histories_for_notification`  Если у пользователя есть зарегистрированное устройство т.е. device_id, То статус меняется на `PUSH ()`.          Если устройства нет, то статус меняется на email
2. `start_sending_push` Вызывается внутри функция ==`send_push`==.  Выбираются пользователи