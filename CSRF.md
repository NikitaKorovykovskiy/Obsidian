Атака [подделки межсайтовых запросов (CSRF)](https://owasp.org/www-community/attacks/csrf) происходит, когда вредоносный веб-сайт, электронная почта, блог, мгновенное сообщение или программа обманом заставляет веб-браузер аутентифицированного пользователя выполнить нежелательное действие на доверенном сайте. Если целевой пользователь аутентифицирован на сайте, незащищенные целевые сайты не могут отличить законные авторизованные запросы от поддельных аутентифицированных запросов.

Поскольку запросы браузера автоматически включают все файлы cookie, включая файлы cookie сеанса, эта атака работает, если не используется надлежащая авторизация, а это означает, что механизм запроса-ответа целевого сайта не проверяет личность и полномочия запрашивающего. По сути, CSRF-атаки заставляют целевую систему выполнять указанные злоумышленником функции через браузер жертвы без ведома жертвы (обычно до тех пор, пока не будут совершены несанкционированные действия).

## Как от нее защититься?

Эффективным и общепринятым на сегодня способом защиты от CSRF-Атаки является **токен**. Под токеном имеется в виду случайный набор байт, который сервер передает клиенту, а клиент возвращает серверу.

Защита сводится к проверке токена, который сгенерировал сервер, и токена, который прислал пользователь.
## Требования к токену:
- Уникальный токен для каждой операции
- Действует единожды
- Имеет размер, устойчивый к подбору
- Сгенерирован криптографически стойким генератором псевдослучайных чисел
- Имеет ограниченное время жизни

## Требования к Web-Сервису и окружению:

- Отсутствие **XSS** уязвимостей
    Вндренный злоумышленником скрипт имеет возможность отправлять запрос к серверу от имени пользователя и читать его без каких-либо препятствий.
    
    Таким образом, XSS уязвимости могут быть использованы для получения текущего токена.

- Отсутствие **malware** на машине клиента
	Если злоумышленник имеет возможность запускать софт на машине клиента, то он может получить любые данные, имеющиеся в браузере.

## Методы защиты
Существует 3 метода использования токенов для защиты web-сервисов от CSRF атак:

  

- [Synchronizer Tokens](https://habr.com/ru/articles/318748/#synchronizer-tokens) (_Statefull_)
- [Double Submit Cookie](https://habr.com/ru/articles/318748/#double-submit-cookie) (_Stateless_)
- [Encrypted Token](https://habr.com/ru/articles/318748/#encrypted-token) (_Stateless_)